<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>라이더 홈페이지</title>
    <link rel="stylesheet" href="rider.css">
</head>
<body>

<header>
    <h1>라이더 홈페이지</h1>
</header>

<main>
    <section id="orders">
        <h2>배송 목록</h2>
        <!-- 여기에 배송 목록이 표시될 부분 -->

        <!-- Adding a link to order information page -->
        <p>주문자 정보: <a href="order_info.html">주문 상세보기</a></p>
    </section>

    <section id="status">
        <h2>배송 상태 업데이트</h2>
        <form id="statusForm">
            <label for="orderID">주문 ID:</label>
            <input type="text" id="orderID" name="orderID" required>

            <label for="status">상태 업데이트:</label>
            <select id="status1" name="status" required>
                <option value="배송 준비 중">배송 준비 중</option>
                <option value="배송 중">배송 중</option>
                <option value="배송 완료">배송 완료</option>
            </select>

            <button type="submit">상태 업데이트</button>
        </form>

        <!-- 추가된 부분: 반경 5km 내 매장에서 배달 접수 및 주문 취소 -->
        <form id="deliveryForm">
            <label for="orderDistance">주문 거리:</label>
            <input type="text" id="orderDistance" name="orderDistance" placeholder="주문 거리(KM)" required>

            <button type="submit">배달 접수 및 주문 취소</button>
        </form>
    </section>
</main>

<footer>
    <p>&copy; yudelivery</p>
</footer>

<script>
    document.getElementById("statusForm").addEventListener("submit", function(event) {
        event.preventDefault();

        var orderID = document.getElementById("orderID").value;
        var status = document.getElementById("status1").value;

        // 서버로 요청을 보내는 부분
        fetch("/riders/getByCustomerId/" + orderID)
            .then(response => response.json())
            .then(data => {
                if (data.customerId) {
                    // 서버로부터 받은 customerId를 이용해 주문자 정보 업데이트
                    updateCustomerInfo(data.customerId, status);
                } else {
                    alert("주문자 정보를 찾을 수 없습니다.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("서버와의 통신 중 오류가 발생했습니다.");
            });
    });

    // 서버로 주문자 정보 업데이트 요청을 보내는 함수
    function updateCustomerInfo(customerId, status) {
        fetch("/riders/completeDelivery/" + customerId, {
            method: "PUT"
        })
            .then(response => response.text())
            .then(data => {
                console.log(data);
                // 여기서는 간단하게 성공/실패 여부를 확인하고, 성공 시 주문 정보 페이지로 이동
                if (data === "success") {
                    window.location.href = "order_information.html";
                } else {
                    alert("주문자 정보 업데이트에 실패했습니다.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("서버와의 통신 중 오류가 발생했습니다.");
            });
    }

    // 추가된 부분: 서버로 반경 5km 내 매장에서 배달 접수 및 주문 취소 요청을 보내는 함수
    document.getElementById("deliveryForm").addEventListener("submit", function(event) {
        event.preventDefault();

        var orderDistance = document.getElementById("orderDistance").value;

        // 서버로 반경 5km 내 매장에서 배달 접수 및 주문 취소 요청을 보내는 부분
        fetch("/riders/acceptDeliveryAndCancelOrder?distance=" + orderDistance, {
            method: "POST"
        })
            .then(response => response.text())
            .then(data => {
                console.log(data);
                // 여기서는 간단하게 성공/실패 여부를 확인하고, 메시지를 표시
                alert(data);
            })
            .catch(error => {
                console.error("Error:", error);
                alert("서버와의 통신 중 오류가 발생했습니다.");
            });
    });
</script>
</body>
</html>
